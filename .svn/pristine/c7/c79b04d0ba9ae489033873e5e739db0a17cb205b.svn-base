package com.qs.webside.api.controller;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import com.qs.cfg.acti.service.StoreService;
import com.qs.cfg.sys.service.SystemRoomService;
import com.qs.common.base.basecontroller.BaseController;
import com.qs.common.common.Common;
import com.qs.common.exception.SystemException;



@Controller
@Scope("prototype")
@RequestMapping("/api/config/")
public class ConfigController extends BaseController {
	
	@Value("${cfg.dir}")
	private String cfgDir;
	
	@Autowired
	private StoreService storeService;
	@Autowired
	private SystemRoomService systemRoomService;

	/**
	 * 生成房间配置
	 * @param model
	 * @param request
	 * @param id
	 * @return
	 */
	@RequestMapping("add.html")
	public String createConfigFile(Model model, HttpServletRequest request) {
		try{
			//创建房间Json
			systemRoomService.createRoomJson();
			//创建房间xml
			systemRoomService.createRoomXml();
			//创建商家Json
			storeService.createStoreJson();
			//创建商家Xml
			storeService.createStoreXml();

			model.addAttribute("roomData", "room.data");
			model.addAttribute("configXml", "c_config.xml");
			model.addAttribute("commonData", "common.data");
			model.addAttribute("commonXml", "common.xml");
			
			return Common.BACKGROUND_PATH + "/cfg/cfg_view";
		}catch(Exception e)
		{
			throw new SystemException(e);
		}
	}
	
	
	

	
}
